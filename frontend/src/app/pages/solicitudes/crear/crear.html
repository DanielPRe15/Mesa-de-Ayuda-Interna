<div class="crear-container">
  <!-- Toolbar -->
  <mat-toolbar class="toolbar-header">
    <h1 class="toolbar-title">Mesa de Ayuda</h1>
    <span class="spacer"></span>
    <button mat-icon-button (click)="cancelar()">
      <mat-icon>close</mat-icon>
    </button>
  </mat-toolbar>

  <!-- Main Content -->
  <div class="main-content">
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>Nueva Solicitud</mat-card-title>
        <mat-card-subtitle>Completa el formulario para crear una nueva solicitud</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <!-- Loading spinner -->
        <div *ngIf="cargando" class="loading-overlay">
          <mat-spinner diameter="50"></mat-spinner>
        </div>

        <form [formGroup]="crearForm" (ngSubmit)="crearSolicitud()" class="form">
          <!-- Título -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Título</mat-label>
            <input 
              matInput 
              formControlName="titulo"
              placeholder="Describe el problema"
              maxlength="100">
            <mat-icon matSuffix>subject</mat-icon>
            <mat-hint align="end">{{ crearForm.get('titulo')?.value?.length || 0 }}/100</mat-hint>
            <mat-error *ngIf="hasError('titulo', 'required')">
              El título es requerido
            </mat-error>
            <mat-error *ngIf="hasError('titulo', 'minlength')">
              El título debe tener al menos 5 caracteres
            </mat-error>
          </mat-form-field>

          <!-- Descripción -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descripción</mat-label>
            <textarea 
              matInput 
              formControlName="descripcion"
              placeholder="Describe en detalle..."
              rows="5"
              maxlength="500"></textarea>
            <mat-icon matSuffix>description</mat-icon>
            <mat-hint align="end">{{ crearForm.get('descripcion')?.value?.length || 0 }}/500</mat-hint>
            <mat-error *ngIf="hasError('descripcion', 'required')">
              La descripción es requerida
            </mat-error>
            <mat-error *ngIf="hasError('descripcion', 'minlength')">
              La descripción debe tener al menos 10 caracteres
            </mat-error>
          </mat-form-field>

          <!-- Row: Prioridad y Estado -->
          <div class="form-row">
            <!-- Prioridad -->
            <mat-form-field appearance="outline">
              <mat-label>Prioridad</mat-label>
              <mat-select formControlName="prioridad">
                <mat-option *ngFor="let p of prioridades" [value]="p">
                  {{ p }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>priority_high</mat-icon>
              <mat-error *ngIf="hasError('prioridad', 'required')">
                La prioridad es requerida
              </mat-error>
            </mat-form-field>

            <!-- Estado -->
            <mat-form-field appearance="outline">
              <mat-label>Estado</mat-label>
              <mat-select formControlName="estado">
                <mat-option *ngFor="let e of estados" [value]="e">
                  {{ e }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>info</mat-icon>
              <mat-error *ngIf="hasError('estado', 'required')">
                El estado es requerido
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Botones -->
          <div class="button-group">
            <button 
              type="button" 
              mat-stroked-button 
              (click)="cancelar()"
              [disabled]="cargando">
              <mat-icon>cancel</mat-icon>
              Cancelar
            </button>
            <button 
              type="submit" 
              mat-raised-button 
              color="primary"
              [disabled]="cargando">
              <mat-icon>add_circle</mat-icon>
              {{ cargando ? 'Creando...' : 'Crear' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
