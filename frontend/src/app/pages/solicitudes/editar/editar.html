<div class="editar-container">
  <!-- Toolbar -->
  <mat-toolbar class="toolbar-header">
    <h1 class="toolbar-title">Mesa de Ayuda</h1>
    <span class="spacer"></span>
    <button mat-icon-button (click)="cancelar()">
      <mat-icon>close</mat-icon>
    </button>
  </mat-toolbar>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Loading spinner -->
    <div *ngIf="cargando" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando solicitud...</p>
    </div>

    <!-- Form Card -->
    <mat-card *ngIf="!cargando" class="form-card">
      <mat-card-header>
        <mat-card-title>Editar Solicitud #{{ id }}</mat-card-title>
        <mat-card-subtitle>Modifica los datos de la solicitud</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <!-- Loading overlay -->
        <div *ngIf="guardando" class="loading-overlay">
          <mat-spinner diameter="50"></mat-spinner>
        </div>

        <form [formGroup]="editarForm" (ngSubmit)="guardarCambios()" class="form">
          <!-- Título -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Título</mat-label>
            <input 
              matInput 
              formControlName="titulo"
              placeholder="Describe el problema"
              required>
            <mat-icon matSuffix>subject</mat-icon>
            <mat-error *ngIf="hasError('titulo', 'required')">El título es requerido</mat-error>
            <mat-error *ngIf="hasError('titulo', 'minlength')">Mínimo 5 caracteres</mat-error>
            <mat-hint align="end">{{ editarForm.get('titulo')?.value?.length || 0 }}/100</mat-hint>
          </mat-form-field>

          <!-- Descripción -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descripción</mat-label>
            <textarea 
              matInput 
              formControlName="descripcion"
              placeholder="Describe en detalle..."
              rows="5"
              required></textarea>
            <mat-icon matSuffix>description</mat-icon>
            <mat-error *ngIf="hasError('descripcion', 'required')">La descripción es requerida</mat-error>
            <mat-error *ngIf="hasError('descripcion', 'minlength')">Mínimo 10 caracteres</mat-error>
            <mat-hint align="end">{{ editarForm.get('descripcion')?.value?.length || 0 }}/500</mat-hint>
          </mat-form-field>

          <!-- Row: Prioridad y Estado -->
          <div class="form-row">
            <!-- Prioridad -->
            <mat-form-field appearance="outline">
              <mat-label>Prioridad</mat-label>
              <mat-select formControlName="prioridad" required>
                <mat-option *ngFor="let p of prioridades" [value]="p">
                  {{ p }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>priority_high</mat-icon>
            </mat-form-field>

            <!-- Estado -->
            <mat-form-field appearance="outline">
              <mat-label>Estado</mat-label>
              <mat-select formControlName="estado" required>
                <mat-option *ngFor="let e of estados" [value]="e">
                  {{ e }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>info</mat-icon>
            </mat-form-field>
          </div>

          <!-- Botones -->
          <div class="button-group">
            <button 
              type="button" 
              mat-stroked-button 
              (click)="cancelar()"
              [disabled]="guardando">
              <mat-icon>cancel</mat-icon>
              Cancelar
            </button>
            <button 
              type="submit" 
              mat-raised-button 
              color="primary"
              [disabled]="editarForm.invalid || guardando">
              <mat-icon>save</mat-icon>
              {{ guardando ? 'Guardando...' : 'Guardar Cambios' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
